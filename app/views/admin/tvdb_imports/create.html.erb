<% content_for :title, "Importing #{@show_name}" %>

<div class="page">
  <div class="page-header">
    <div>
      <p class="eyebrow">Admin</p>
      <h1>Importing <%= @show_name %></h1>
      <p class="muted">Pulling episodes from TVDB in batches to avoid timeouts.</p>
    </div>
    <div class="actions">
      <%= link_to "Back to TVDB search", admin_tvdb_import_path(query: @query), class: "button" %>
    </div>
  </div>

  <div class="import-panel">
    <div class="show-summary">
      <div>
        <p class="eyebrow">Show</p>
        <h2><%= @show_name %></h2>
        <% if @show_description.present? %>
          <p class="muted"><%= @show_description %></p>
        <% end %>
      </div>
    </div>

    <div
      class="import-progress"
      data-controller="tvdb-import"
      data-tvdb-import-series-id-value="<%= @series_id %>"
      data-tvdb-import-show-name-value="<%= @show_name %>"
      data-tvdb-import-show-description-value="<%= @show_description.to_s %>"
      data-tvdb-import-query-value="<%= @query %>"
      data-tvdb-import-batch-url-value="<%= admin_tvdb_import_batch_path %>"
      data-tvdb-import-next-page-value="0"
    >
      <div class="progress">
        <div class="progress-bar" data-tvdb-import-target="bar"></div>
      </div>
      <div class="progress-meta">
        <div data-tvdb-import-target="status">Starting import…</div>
        <div class="muted small" data-tvdb-import-target="counts">Waiting for first batch…</div>
      </div>

      <div class="progress-log" data-tvdb-import-target="log">
        <p class="muted small">No batches processed yet.</p>
      </div>
    </div>
  </div>
</div>
